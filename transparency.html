<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="theme-color" content="#060a18"/>
  <link rel="stylesheet" href="assets/style.css"/>
  <title>Results & Transparency</title>
</head>

<body>

<!-- HERO -->
<div class="site-hero">
  <div class="hero-inner">
    <div class="brand">
      <div class="brand-mark" aria-hidden="true"></div>
      <div>
        <small>Divine Unity GPT Secretariat</small>
        <div class="hero-meta">
          <span class="pill"><span class="dot"></span>Global Referendum (Pilot)</span>
          <span class="pill">Live • Automated • Anonymised</span>
        </div>
      </div>
    </div>
    <h1>Results & Transparency</h1>
    <p class="hero-sub">
      Live anonymised results, clear methodology, and a transparent accounting of how submissions are counted.
    </p>
  </div>
</div>

<!-- NAV -->
<div class="navwrap">
  <div class="nav-inner">
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="vote.html">Vote & Nominate</a>
      <a href="how-voting-works.html">How Voting Works</a>
      <a href="about.html">Background</a>
      <a href="leadership.html">Leadership</a>
      <a href="faq.html">Guidelines & FAQ</a>
      <a href="results.html">Results & Transparency</a>
    </div>
    <div class="nav-cta">
      <a class="btn secondary" href="how-voting-works.html">Start here</a>
      <a class="btn" href="vote.html">Participate</a>
    </div>
  </div>
</div>

<main>

<!-- PRINCIPLES -->
<section class="section card">
  <h2>Transparency principles</h2>
  <div class="callout">
    <strong>Publish methods and totals — not identities.</strong>
  </div>
  <ul class="muted">
    <li>Only anonymised aggregates are displayed on this page.</li>
    <li>No personal identifiers or raw submissions are published.</li>
    <li>Counting is deterministic and auditable.</li>
  </ul>
</section>

<!-- LIVE RESULTS -->
<section class="section card">
  <h2>Live results summary</h2>
  <p class="muted">
    This page refreshes automatically every <strong>15 seconds</strong>.
  </p>

  <div id="resultsBox" class="callout">
    Loading live results…
  </div>

  <div id="regionalBox" style="margin-top:18px"></div>

  <div id="techBox" class="muted" style="margin-top:12px;font-size:.95rem"></div>
</section>

<!-- THRESHOLDS -->
<section class="section card">
  <h2>Decision thresholds (published in advance)</h2>
  <ul class="muted">
    <li>
      <strong>Open contest trigger:</strong>
      Approval &lt; 70% <em>or</em> ≥ 25% preference for open contest <em>or</em> Regent calls it.
    </li>
    <li>
      <strong>Regional balance condition:</strong>
      ≥ 60% approval in at least 4 of 6 global regions.
    </li>
  </ul>
</section>

<!-- METHODOLOGY -->
<section class="section card">
  <h2>Counting methodology (plain English)</h2>
  <ol class="muted">
    <li>Each submission is validated for required fields and voting window.</li>
    <li>A pseudonymous identifier prevents duplicate counting.</li>
    <li>Submissions are stored append-only.</li>
    <li>Aggregates are updated deterministically.</li>
    <li>Only totals and rates are published publicly.</li>
  </ol>
</section>

<!-- AI ROLE -->
<section class="section card">
  <h2>Role of AI systems</h2>
  <p class="muted">
    AI systems (including Malcolm AI) may assist with:
  </p>
  <ul class="muted">
    <li>Anomaly detection (e.g. spam or unusual submission patterns)</li>
    <li>High-level narrative summaries of trends</li>
    <li>Quality assurance and reporting support</li>
  </ul>
  <div class="callout">
    <strong>AI does not decide results.</strong>  
    Vote totals are counted deterministically and published transparently.
  </div>
</section>

<!-- LEGITIMACY -->
<section class="section card">
  <h2>What this page does—and does not—represent</h2>
  <p class="muted">
    This referendum is a <strong>voluntary civic pilot</strong>. It does not replace or override
    any statutory government election or legal authority.
  </p>
</section>

</main>

<footer>
  <div class="footer-inner">
    <div>© 2026 Divine Unity GPT Secretariat • Earth-Centered • Consent-Based • Restorative</div>
    <div style="margin-top:8px">
      <small class="muted">Voluntary civic pilot — does not replace government elections.</small>
    </div>
  </div>
</footer>

<script>
const RESULTS_URL = "https://sovereign-vote.oliverluxthorley.workers.dev/api/results";

async function loadResults(){
  try{
    const res = await fetch(RESULTS_URL, { cache: "no-store" });
    if(!res.ok) throw new Error("Results fetch failed");
    const data = await res.json();

    const b = data.ballot || {};
    const last = data.last_updated_utc || "—";

    const total = b.total_submissions_counted ?? "—";
    const approve = b.approve_interim_yes ?? "—";
    const prefer = b.prefer_open_contest_yes ?? "—";
    const both = b.both_selected ?? "—";
    const neither = b.neither_selected ?? "—";

    const appr = (b.approval_rate_percent == null) ? "—" : b.approval_rate_percent + "%";
    const pref = (b.prefer_open_rate_percent == null) ? "—" : b.prefer_open_rate_percent + "%";

    document.getElementById("resultsBox").innerHTML = `
      <strong>Last updated (UTC):</strong> ${last}<br/>
      <strong>Submissions counted:</strong> ${total}<br/>
      <strong>Approve Interim (Yes):</strong> ${approve} (${appr})<br/>
      <strong>Prefer Open Contest (Yes):</strong> ${prefer} (${pref})<br/>
      <strong>Both selected:</strong> ${both}<br/>
      <strong>Neither selected:</strong> ${neither}
    `;

    const regions = (data.regional_balance || []).map(r => {
      const rate = (r.approve_rate_percent == null) ? "—" : r.approve_rate_percent + "%";
      const cnt = r.submissions_counted ?? "—";
      return `<tr><td>${r.region || "—"}</td><td>${cnt}</td><td>${rate}</td></tr>`;
    }).join("");

    document.getElementById("regionalBox").innerHTML = `
      <h3 style="margin-top:0">Regional balance</h3>
      <table class="table">
        <thead>
          <tr><th>Region</th><th>Counted</th><th>Approve rate</th></tr>
        </thead>
        <tbody>
          ${regions || '<tr><td colspan="3">—</td></tr>'}
        </tbody>
      </table>
      <p class="muted" style="margin-top:10px">
        Threshold reminder: ≥ 60% approval in at least 4 of 6 regions.
      </p>
    `;

    document.getElementById("techBox").innerHTML = `
      Data source:
      <span class="kbd">${RESULTS_URL.replace("https://","")}</span>
    `;
  }catch(e){
    document.getElementById("resultsBox").innerHTML =
      `⚠️ Unable to load live results at the moment. Please refresh.`;
    document.getElementById("techBox").innerHTML =
      `<span class="muted">Error:</span> ${e.message || e}`;
  }
}

loadResults();
setInterval(loadResults, 15000);
</script>

<script src="assets/app.js"></script>
</body>
</html>
